<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Heal the Health, Heal Ourselves</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap">
<style>
  :root{
    --bg:#f6fbff;
    --primary:#0b8fbd; /* blue-teal */
    --accent:#1aa38f;
    --card:#ffffff;
    --muted:#6b8b8f;
    --success:#0fa985;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:linear-gradient(180deg,var(--bg),#ffffff 60%);
    font-family:Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto;
    color:#073237;
    overflow-y:auto;
  }

  /* Canvas particle background sits behind everything */
  #bgCanvas{
    position:fixed; inset:0; z-index:0; pointer-events:none;
  }

  /* Header */
  header{
    position:fixed; top:0; left:0; right:0; height:72px;
    display:flex; align-items:center; justify-content:space-between;
    padding:0 28px; background:rgba(255,255,255,0.7);
    backdrop-filter: blur(6px); z-index:20;
    border-bottom:1px solid rgba(9,64,70,0.04);
  }
  .brand {
    display:flex; gap:14px; align-items:center;
  }
  .logo{
    width:52px; height:52px; border-radius:10px;
    background:linear-gradient(180deg,#dff9f6,#c8f0ec); display:grid; place-items:center;
    box-shadow:0 4px 16px rgba(15,90,88,0.06);
  }
  .logo svg{width:34px;height:34px}
  h1{
    font-size:18px; margin:0; color:var(--primary); letter-spacing:0.3px;
  }
  .subtitle {font-size:12px; color:var(--muted); margin-top:4px}

  nav{display:flex; gap:12px; align-items:center}
  nav a{
    text-decoration:none; color:#074b4d; font-weight:600; padding:8px 12px;
    border-radius:8px; transition:0.18s;
  }
  nav a:hover{background:rgba(11,143,189,0.08)}

  /* Layout: content area with padding to avoid header/footer */
  main{
    position:relative; z-index:10;
    padding:92px 40px 180px; max-width:1200px; margin:0 auto;
    display:grid; grid-template-columns: 1fr 360px; gap:24px;
  }

  /* Left column: main content */
  .content {display:flex; flex-direction:column; gap:18px;}

  .card{
    background:var(--card); border-radius:14px; padding:18px;
    box-shadow:0 8px 28px rgba(11,63,63,0.04);
    border:1px solid rgba(10,80,80,0.03);
  }
  .card h2{margin:0 0 8px 0; color:var(--primary)}
  .muted{color:var(--muted); font-size:13px}

  /* Right column: aside widgets */
  aside{display:flex; flex-direction:column; gap:18px; position:sticky; top:88px; height:calc(100vh - 120px); overflow:auto; padding-bottom:40px}

  /* Dashboard at bottom (fixed) */
  #dashboard{
    position:fixed; left:0; right:0; bottom:0; height:120px;
    background:linear-gradient(180deg,#ffffff, #ecfbfa);
    border-top:1px solid rgba(9,64,70,0.04);
    display:flex; align-items:center; justify-content:space-between;
    padding:12px 28px; gap:18px; z-index:25;
  }
  .dash-left{display:flex; gap:16px; align-items:center}
  .aqi-gauge{width:120px; height:120px; display:grid; place-items:center}
  .aqi-info{display:flex; flex-direction:column; gap:4px}
  .aqi-val{font-size:20px; font-weight:800; color:#073237}
  .aqi-label{font-size:13px; color:var(--muted)}

  .dash-right{display:flex; gap:16px; align-items:center}

  /* News */
  .news-list{display:flex; flex-direction:column; gap:10px}
  .news-item{background:linear-gradient(180deg,#f8ffff,#fbfffe); padding:10px;border-radius:10px;border:1px solid rgba(8,80,80,0.04); font-size:14px}

  /* Health record */
  .form-row{display:flex; gap:8px; align-items:center; margin-top:10px}
  input[type="text"], input[type="number"], textarea, select {
    width:100%; padding:10px; border-radius:8px; border:1px solid #e9f7f6; background:#fbfffe;
    color:#073237; font-size:14px;
  }
  textarea{min-height:72px; resize:vertical}

  .btn{background:var(--primary); color:white; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700}
  .btn.secondary{background:#e6f7f6; color:var(--primary); font-weight:700}
  .small{font-size:12px; color:var(--muted)}

  /* Gallery */
  .gallery{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
  .gallery img{width:90px; height:90px; object-fit:cover; border-radius:8px; border:2px solid #e6fbf8}

  /* Quiz */
  .quiz q{display:block}

  /* Responsive */
  @media (max-width:1000px){
    main{grid-template-columns:1fr; padding:110px 18px 220px}
    aside{position:static;height:auto}
    #dashboard{height:140px; flex-direction:column; gap:8px; padding:12px}
    .aqi-gauge{width:96px;height:96px}
  }
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>

<header>
  <div class="brand">
    <div class="logo" aria-hidden="true">
      <!-- leaf + heartbeat icon -->
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 36c6-18 26-26 38-20-10 8-10 18-10 28 0 10-12 12-20 4 4-4-2-10-8-12z" fill="#0b8fbd" opacity="0.08"/>
        <path d="M22 46c-1-10 6-22 16-26" stroke="#0b8fbd" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        <path d="M36 28c8-4 14-2 18 4" stroke="#1aa38f" stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
    </div>
    <div>
      <h1>HEAL THE HEALTH, HEAL OURSELVES</h1>
      <div class="subtitle">í™˜ê²½ ë°ì´í„° Ã— ê°œì¸ ê±´ê°• â€” ì‹¤ì‹œê°„ìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤</div>
    </div>
  </div>

  <nav>
    <a href="#problem">ë¬¸ì œ ì¸ì‹</a>
    <a href="#solution">í•´ê²° ì•„ì´ë””ì–´</a>
    <a href="#health-approach">ë³´ê±´í•™ì  ì ‘ê·¼</a>
    <a href="#participation">ì°¸ì—¬Â·í–‰ë™</a>
  </nav>
</header>

<main>
  <section class="content">
    <!-- Hero / ìš”ì•½ -->
    <div class="card" aria-labelledby="heroTitle">
      <h2 id="heroTitle">í™˜ê²½ê³¼ ê±´ê°•, ì—°ê²°ëœ ì´ì•¼ê¸°</h2>
      <p class="muted">ëŒ€ê¸°ì˜¤ì—¼ê³¼ ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì€ ë‹¨ìˆœí•œ í™˜ê²½ ë¬¸ì œê°€ ì•„ë‹™ë‹ˆë‹¤. ìš°ë¦¬ì˜ íì™€ ìˆœí™˜ê³„, ë©´ì—­ì— ì˜í–¥ì„ ì£¼ëŠ” ê³µì¤‘ë³´ê±´ ì´ìŠˆì…ë‹ˆë‹¤. ì´ ì‚¬ì´íŠ¸ëŠ” í™˜ê²½ ë°ì´í„°ë¥¼ ê°œì¸ ê±´ê°• ì •ë³´ì™€ ì—°ê²°í•´ ì¦‰ê°ì ì¸ ê¶Œê³ ì™€ í–‰ë™ì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
    </div>

    <!-- Problem -->
    <div id="problem" class="card">
      <h2>ë¬¸ì œ ì¸ì‹</h2>
      <p>ëŒ€ê¸° ì¤‘ ì´ˆë¯¸ì„¸ë¨¼ì§€(PM2.5), ë„ì‹œ ëŒ€ê¸°ì˜¤ì—¼, í•´ì–‘ìœ¼ë¡œ ìœ ì…ë˜ëŠ” ë¯¸ì„¸í”Œë¼ìŠ¤í‹± ë“±ì€ ì‚¬ëŒë“¤ì˜ í˜¸í¡ê¸°Â·ì‹¬í˜ˆê´€ê³„ ë° ë‚´ë¶„ë¹„ê³„ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤. íŠ¹íˆ ì·¨ì•½ê³„ì¸µ(ë…¸ì•½ì, ì–´ë¦°ì´, ê¸°ì €ì§ˆí™˜ì)ì€ ë” í° ìœ„í—˜ì— ë…¸ì¶œë©ë‹ˆë‹¤.</p>
      <ul class="small" style="margin-top:8px">
        <li>ì¥ê¸°ì  ë…¸ì¶œì€ ë§Œì„±í˜¸í¡ê¸° ì§ˆí™˜ê³¼ ì‹¬í˜ˆê´€ê³„ ì§ˆí™˜ ìœ„í—˜ì„ ë†’ì…ë‹ˆë‹¤.</li>
        <li>ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì€ ì‹í’ˆì‚¬ìŠ¬ì„ í†µí•´ ì¸ì²´ì— ì¶•ì ë  ê°€ëŠ¥ì„±ì´ ì œê¸°ë©ë‹ˆë‹¤.</li>
      </ul>
    </div>

    <!-- Solution -->
    <div id="solution" class="card">
      <h2>í•´ê²° ì•„ì´ë””ì–´</h2>
      <p>ê°œì¸ ê±´ê°• ê¸°ë¡ê³¼ ì§€ì—­ í™˜ê²½(ëŒ€ê¸°ì§ˆ, ê¸°ì˜¨, ìŠµë„)ì„ ì—°ë™í•œ ë§ì¶¤í˜• ëŒ€ì‹œë³´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì‹¤ì‹œê°„ ì•Œë¦¼, ì¼ì¼ ê¶Œì¥ìˆ˜ì¹™, ì»¤ë®¤ë‹ˆí‹° ê¸°ë°˜ ì‹¤ì²œ ì¸ì¦ì„ í†µí•´ ì‹œë¯¼ ì°¸ì—¬ë¥¼ ì´‰ì§„í•©ë‹ˆë‹¤.</p>
      <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap">
        <div style="flex:1; min-width:180px; background:linear-gradient(180deg,#e9fbf9,#f2fff8); padding:10px; border-radius:10px">ìœ„ì¹˜ê¸°ë°˜ AQI</div>
        <div style="flex:1; min-width:180px; background:linear-gradient(180deg,#eef6ff,#f8fdff); padding:10px; border-radius:10px">ê±´ê°• í”„ë¡œí•„ ì—°ë™</div>
        <div style="flex:1; min-width:180px; background:linear-gradient(180deg,#fff7ef,#fffdf8); padding:10px; border-radius:10px">ì‹œë¯¼ ì‹¤ì²œ ì¸ì¦</div>
      </div>
    </div>

    <!-- Health approach -->
    <div id="health-approach" class="card">
      <h2>ë³´ê±´í•™ì  ì ‘ê·¼</h2>
      <p>í™˜ê²½ë³´ê±´í•™ì€ ì˜¤ì—¼ ë¬¼ì§ˆì´ ì¸ì²´ì— ë¯¸ì¹˜ëŠ” ìƒë¦¬ì  ì˜í–¥ì„ ë¶„ì„í•˜ê³ , ê³µì¤‘ë³´ê±´ ì°¨ì›ì˜ ì˜ˆë°© ì „ëµì„ ì œì‹œí•©ë‹ˆë‹¤. ë³¸ ì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒì„ ê²°í•©í•©ë‹ˆë‹¤:</p>
      <ul class="small" style="margin-top:8px">
        <li>ê°œì¸ ê±´ê°• ê¸°ë¡ â†’ ì¦ìƒ ì¶”ì  ë° íŒ¨í„´ ë¶„ì„</li>
        <li>í™˜ê²½ ë°ì´í„° ì‹œê°í™” â†’ ìœ„í—˜ë„ ì¶”ì </li>
        <li>ë§ì¶¤í˜• ê¶Œê³  â†’ ì‹¤ì²œ ìœ ë„</li>
      </ul>
    </div>

    <!-- Participation -->
    <div id="participation" class="card">
      <h2>ì°¸ì—¬ ë° í–‰ë™</h2>
      <p>ì‘ì€ ì‹¤ì²œì´ ëª¨ì´ë©´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤. ì‹¤ì²œ ì¸ì¦ì„ ì—…ë¡œë“œí•˜ê³ , ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ê³µìœ í•˜ì„¸ìš”. ë˜í•œ í”„ë¡œì íŠ¸ë¥¼ í›„ì›í•˜ì—¬ ë” ë§ì€ ê¸°ëŠ¥(ì‹¤ì œ ì„¼ì„œ ì—°ë™, ë¦¬í¬íŠ¸ ì œì‘ ë“±)ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

      <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap">
        <button class="btn" onclick="document.getElementById('uploadInput').click()">ì‹¤ì²œ ì¸ì¦ ì—…ë¡œë“œ</button>
        <button class="btn secondary" onclick="openDonateModal()">í›„ì›í•˜ê¸°</button>
        <button class="btn secondary" onclick="scrollToQuiz()">í™˜ê²½ í€´ì¦ˆ í’€ê¸°</button>
      </div>

      <!-- Gallery preview -->
      <div class="gallery card" style="margin-top:12px" id="galleryPreview"></div>

    </div>

    <!-- News summary -->
    <div class="card">
      <h2>ë‰´ìŠ¤ ìš”ì•½</h2>
      <div class="news-list" id="newsList">
        <div class="news-item">ğŸŒ WHO: ëŒ€ê¸°ì˜¤ì—¼ ê´€ë ¨ ì¡°ê¸° ì‚¬ë§ ë¦¬í¬íŠ¸(ìƒ˜í”Œ)</div>
        <div class="news-item">ğŸ’§ ë¯¸ì„¸í”Œë¼ìŠ¤í‹±, ì¸ì²´ ì¥ê¸° ê²€ì¶œ ì‚¬ë¡€ ë³´ê³ (ìƒ˜í”Œ)</div>
        <div class="news-item">ğŸŒ± ë„ì‹œ ë…¹ì§€ ì¡°ì„±ìœ¼ë¡œ ì •ì‹ ê±´ê°• ê°œì„  ì—°êµ¬ ë°œí‘œ(ìƒ˜í”Œ)</div>
      </div>
    </div>

    <!-- Quiz & Result -->
    <div id="quizCard" class="card">
      <h2 id="quizTitle">ê°„ë‹¨í•œ í™˜ê²½ í€´ì¦ˆ</h2>
      <div id="quizBody">
        <div style="margin-bottom:8px">
          <label>1) ì£¼ë¡œ ì–´ë–¤ êµí†µìˆ˜ë‹¨ì„ ì´ìš©í•˜ë‚˜ìš”?</label><br>
          <select id="q1"><option value="2">ëŒ€ì¤‘êµí†µ/ë„ë³´</option><option value="0">ìê°€ìš©</option></select>
        </div>
        <div style="margin-bottom:8px">
          <label>2) ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì´ë ¤ ë…¸ë ¥í•˜ë‚˜ìš”?</label><br>
          <select id="q2"><option value="2">í•­ìƒ</option><option value="1">ê°€ë”</option><option value="0">ì•„ë‹ˆìš”</option></select>
        </div>
        <div style="margin-bottom:8px">
          <label>3) í™˜ê²½ ê´€ë ¨ ì •ë³´ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸í•˜ë‚˜ìš”?</label><br>
          <select id="q3"><option value="2">ìì£¼ í™•ì¸</option><option value="0">ê±°ì˜ ì•ˆí•¨</option></select>
        </div>
        <button class="btn" onclick="computeEnvIndex()">ê²°ê³¼ í™•ì¸</button>
        <div id="quizResult" class="small" style="margin-top:10px"></div>
      </div>
    </div>

    <!-- Health record history -->
    <div class="card">
      <h2>ë‚´ ê±´ê°• ê¸°ë¡</h2>
      <p class="small">ì¦ìƒê³¼ ì»¨ë””ì…˜ì„ ê¸°ë¡í•˜ë©´, ê°„ë‹¨í•œ í”¼ë“œë°±ì„ ì¦‰ì‹œ ì œê³µí•©ë‹ˆë‹¤. ê¸°ë¡ì€ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤.</p>
      <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap">
        <input type="text" id="personName" placeholder="ì´ë¦„ (ì„ íƒ)" style="max-width:200px">
        <input type="number" id="personAge" placeholder="ë‚˜ì´" style="max-width:120px">
      </div>
      <div style="margin-top:8px">
        <textarea id="healthNote" placeholder="ì˜¤ëŠ˜ì˜ ì»¨ë””ì…˜ì´ë‚˜ ì¦ìƒ(ì˜ˆ: ë‘í†µ, ê¸°ì¹¨, ìˆ¨ê°€ì¨ ë“±)"></textarea>
      </div>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn" onclick="saveHealthRecord()">ê¸°ë¡ ì €ì¥</button>
        <button class="btn secondary" onclick="exportHealth()">ë‚´ë³´ë‚´ê¸°(CSV)</button>
      </div>

      <div id="recordList" style="margin-top:12px"></div>
    </div>

  </section>

  <!-- Right column -->
  <aside>
    <!-- AQI chart + mini stats -->
    <div class="card">
      <h2>ì‹¤ì‹œê°„ í™˜ê²½ ë°ì´í„°</h2>
      <canvas id="aqiChart" style="max-width:260px; margin:6px auto;"></canvas>
      <div style="display:flex; gap:8px; justify-content:center; margin-top:6px">
        <div style="text-align:center"><div class="small">ì˜¨ë„</div><div id="tempVal">--Â°C</div></div>
        <div style="text-align:center"><div class="small">ìŠµë„</div><div id="humVal">--%</div></div>
      </div>
      <div style="margin-top:8px; display:flex; gap:8px; justify-content:center">
        <button class="btn" onclick="simulateRealtime()">ë°ì´í„° ê°±ì‹ </button>
        <button class="btn secondary" onclick="shareSummary()">ê³µìœ </button>
      </div>
    </div>

    <!-- News highlights -->
    <div class="card">
      <h2>ë‰´ìŠ¤ í•˜ì´ë¼ì´íŠ¸</h2>
      <div class="news-list">
        <div class="news-item">âœ”ï¸ ë¯¸ì„¸ë¨¼ì§€ ì£¼ì˜ë³´ ë°œë ¹(ìƒ˜í”Œ)</div>
        <div class="news-item">âœ”ï¸ ì§€ì—­ ì»¤ë®¤ë‹ˆí‹° ì‹¤ì²œ ìº í˜ì¸ (ìƒ˜í”Œ)</div>
      </div>
    </div>

    <!-- Donation & missions -->
    <div class="card">
      <h2>í›„ì› Â· ë¯¸ì…˜</h2>
      <p class="small">í”„ë¡œì íŠ¸ ìš´ì˜ ë° ê¸°ëŠ¥ í™•ì¥ì„ ìœ„í•œ í›„ì›ì€ í° í˜ì´ ë©ë‹ˆë‹¤.</p>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button class="btn" onclick="openDonateModal()">í›„ì›í•˜ê¸°</button>
        <button class="btn secondary" onclick="document.getElementById('supportList').innerText = 'í›„ì› ë‚´ì—­ ë¶ˆëŸ¬ì˜´(ë¡œì»¬)'; loadDonations()">ë‚´ì—­</button>
      </div>

      <div style="margin-top:10px">
        <label class="small">ì˜¤ëŠ˜ì˜ ì‹¤ì²œ ì²´í¬</label>
        <div style="display:flex; gap:8px; margin-top:6px">
          <label><input type="checkbox" id="m1"> í…€ë¸”ëŸ¬</label>
          <label><input type="checkbox" id="m2"> ëŒ€ì¤‘êµí†µ</label>
          <label><input type="checkbox" id="m3"> í•„í„° êµì²´</label>
        </div>
        <div style="margin-top:8px">
          <button class="btn" onclick="saveMissions()">ì €ì¥</button>
        </div>
        <div id="supportList" class="small" style="margin-top:8px"></div>
      </div>
    </div>

    <!-- Small help -->
    <div class="card">
      <h2>ê°„ë‹¨ ë„ì›€ë§</h2>
      <p class="small">â€¢ ë¯¸ì„¸ë¨¼ì§€ ì‹¬í•  ë• ì‹¤ì™¸í™œë™ì„ ì¤„ì´ì„¸ìš”.<br>â€¢ ì¦ìƒ ì•…í™”ì‹œ ì˜ë£Œê¸°ê´€ ë°©ë¬¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
    </div>
  </aside>
</main>

<!-- Bottom Dashboard -->
<div id="dashboard" role="region" aria-label="í™˜ê²½ ëŒ€ì‹œë³´ë“œ">
  <div class="dash-left">
    <div class="aqi-gauge">
      <canvas id="gaugeCanvas" width="120" height="120"></canvas>
    </div>
    <div class="aqi-info">
      <div class="aqi-val" id="dashAQI">â€”</div>
      <div class="aqi-label" id="dashLabel">ë°ì´í„° ëŒ€ê¸°ì¤‘</div>
    </div>
  </div>

  <div class="dash-right">
    <div style="text-align:right">
      <div class="small">ìœ„ì¹˜</div>
      <div style="font-weight:700">ì„œìš¸ (ìƒ˜í”Œ)</div>
    </div>
    <div style="min-width:160px; text-align:left">
      <div class="small">ì˜¤ëŠ˜ ê¶Œê³ </div>
      <div id="dashTip" style="font-weight:700">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</div>
    </div>
    <div>
      <button class="btn" onclick="simulateRealtime()">ìƒˆë¡œê³ ì¹¨</button>
    </div>
  </div>
</div>

<!-- Hidden inputs & modals -->
<input type="file" id="uploadInput" accept="image/*" style="display:none" onchange="uploadCert(event)">

<!-- Donate Modal -->
<div id="donateModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:60; align-items:center; justify-content:center">
  <div style="background:white; padding:20px; border-radius:12px; width:360px; box-shadow:0 8px 30px rgba(0,0,0,0.2)">
    <h3 style="margin-top:0; color:var(--primary)">í”„ë¡œì íŠ¸ í›„ì›</h3>
    <p class="small">í›„ì›ì€ ê¸°ëŠ¥ ê°œì„ , ì„¼ì„œ ì—°ë™, ë¦¬í¬íŠ¸ ì œì‘ ë“±ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

    <div style="display:flex; gap:8px; margin-top:8px">
      <button class="btn" onclick="donateAmount(3000)">â‚©3,000</button>
      <button class="btn" onclick="donateAmount(10000)">â‚©10,000</button>
      <button class="btn" onclick="donateAmount(30000)">â‚©30,000</button>
    </div>

    <div style="margin-top:10px">
      <input id="donInput" type="number" placeholder="ì§ì ‘ ê¸ˆì•¡ ì…ë ¥ (â‚©)" style="width:100%; padding:10px; border-radius:8px; border:1px solid #eef9f8"/>
      <div style="display:flex; gap:8px; margin-top:10px">
        <button class="btn" onclick="submitDonation()">í›„ì› í™•ì¸</button>
        <button class="btn secondary" onclick="closeDonateModal()">ì·¨ì†Œ</button>
      </div>
    </div>

    <div id="donMsg" class="small" style="margin-top:8px; color:var(--muted)"></div>

    <div style="margin-top:12px; text-align:center">
      <a class="small" href="https://www.buymeacoffee.com" target="_blank" rel="noopener" style="color:var(--primary)">ì™¸ë¶€ ê²°ì œ(BuyMeACoffee)ë¡œ ì´ë™í•˜ê¸°</a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ---------- Particle background (canvas) ---------- */
const cvs = document.getElementById('bgCanvas');
const ctxBg = cvs.getContext('2d');
function resizeCanvas(){
  cvs.width = window.innerWidth;
  cvs.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const particles = [];
for(let i=0;i<80;i++){
  particles.push({
    x: Math.random()*cvs.width,
    y: Math.random()*cvs.height,
    r: 0.6+Math.random()*2.2,
    vx: (Math.random()-0.5)*0.2,
    vy: (Math.random()-0.5)*0.2,
    alpha: 0.05 + Math.random()*0.18
  });
}
function animBg(){
  ctxBg.clearRect(0,0,cvs.width,cvs.height);
  for(const p of particles){
    p.x += p.vx;
    p.y += p.vy;
    if(p.x<0) p.x = cvs.width;
    if(p.x>cvs.width) p.x = 0;
    if(p.y<0) p.y = cvs.height;
    if(p.y>cvs.height) p.y = 0;
    ctxBg.beginPath();
    ctxBg.fillStyle = "rgba(11,143,189,"+p.alpha+")";
    ctxBg.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctxBg.fill();
  }
  requestAnimationFrame(animBg);
}
animBg();

/* ---------- Chart.js: AQI line and gauge(doughnut) ---------- */
let aqiLine; // weekly trend
function initCharts(){
  const lineCtx = document.getElementById('aqiChart').getContext('2d');
  aqiLine = new Chart(lineCtx, {
    type: 'line',
    data: {
      labels: ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'],
      datasets: [{
        label: 'AQI (ì£¼ê°„)',
        data: [55,65,48,72,60,50,42],
        borderColor: '#0b8fbd',
        backgroundColor: 'rgba(11,143,189,0.08)',
        fill: true,
        tension: 0.3,
        pointRadius:4
      }]
    },
    options: { responsive:true, plugins:{legend:{display:false}} , scales:{y:{beginAtZero:true, max:200}}}
  });

  // Gauge using doughnut
  const gaugeCtx = document.getElementById('gaugeCanvas').getContext('2d');
  window.gaugeChart = new Chart(gaugeCtx, {
    type:'doughnut',
    data:{
      labels:['AQI','remaining'],
      datasets:[{
        data:[60, 440], // default; normalized to 500
        backgroundColor:['#1aa38f','#e6f7f6'],
        borderWidth:0
      }]
    },
    options:{
      cutout:'80%',
      rotation: -90 * Math.PI/180,
      circumference: 180 * Math.PI/180,
      plugins:{legend:{display:false}}
    }
  });
}
initCharts();

/* ---------- Dashboard values & behavior ---------- */
function getAqiLabel(aqi){
  if(aqi<=50) return {label:'ì¢‹ìŒ',risk:'ë‚®ìŒ',color:'#1aa38f',tip:'ì•¼ì™¸ í™œë™ ê¶Œì¥'};
  if(aqi<=100) return {label:'ë³´í†µ',risk:'ë³´í†µ',color:'#f9c74f',tip:'ì¥ì‹œê°„ ê²©ë ¬í•œ í™œë™ ìì œ'};
  if(aqi<=200) return {label:'ë‚˜ì¨',risk:'ë†’ìŒ',color:'#f29c9c',tip:'ê¸°ì €ì§ˆí™˜ì ì‹¤ì™¸í™œë™ ì œí•œ'};
  return {label:'ë§¤ìš° ë‚˜ì¨',risk:'ë§¤ìš° ë†’ìŒ',color:'#c04a4a',tip:'ëª¨ë“  ì‚¬ëŒ ì‹¤ì™¸í™œë™ ìì œ'};
}

function updateGauge(aqi){
  const normalized = Math.min(500, Math.max(0, aqi));
  const rem = 500 - normalized;
  window.gaugeChart.data.datasets[0].data = [normalized, rem];
  const lbl = getAqiLabel(aqi);
  window.gaugeChart.data.datasets[0].backgroundColor[0] = lbl.color;
  window.gaugeChart.update();
  document.getElementById('dashAQI').innerText = aqi;
  document.getElementById('dashLabel').innerText = lbl.label;
  document.getElementById('dashTip').innerText = lbl.tip;
}

/* Simulate realtime env */
function randomBetween(min,max){return Math.round(min + Math.random()*(max-min))}
function simulateRealtime(){
  // simulate aqi, temp, hum and push into line chart
  const aqi = randomBetween(25, 160);
  const temp = randomBetween(6, 30);
  const hum = randomBetween(30, 75);

  // push to line dataset (shift)
  const ds = aqiLine.data.datasets[0].data;
  ds.shift(); ds.push(aqi);
  aqiLine.update();

  document.getElementById('tempVal').innerText = temp + "Â°C";
  document.getElementById('humVal').innerText = hum + "%";
  updateGauge(aqi);

  // Feed news small change (simulate)
  const newsList = document.getElementById('newsList');
  const sample = [
    "ë„ì‹¬ ë…¹ì§€ í™•ì¶©, í˜¸í¡ê¸° ì§ˆí™˜ ì™„í™” ì—°êµ¬(ìƒ˜í”Œ)",
    "ì§€ì—­ ê³µê¸°ì¸¡ì •ë§ ìš´ì˜ í™•ëŒ€(ìƒ˜í”Œ)",
    "ë¯¸ì„¸í”Œë¼ìŠ¤í‹± ëª¨ë‹ˆí„°ë§ ë³´ê³ ì„œ ì—…ë°ì´íŠ¸(ìƒ˜í”Œ)",
    "ì–´ë¦°ì´ ê±´ê°• ë³´í˜¸ ìº í˜ì¸ ì‹œì‘(ìƒ˜í”Œ)"
  ];
  newsList.children[Math.floor(Math.random()*newsList.children.length)].innerText = "â€¢ " + sample[Math.floor(Math.random()*sample.length)];
}

/* Auto simulate on load & every 12s */
simulateRealtime();
setInterval(simulateRealtime, 12000);

/* ---------- Health record (localStorage) ---------- */
const HEALTH_KEY = 'heal_health_records_v1';
function saveHealthRecord(){
  const name = document.getElementById('personName').value || 'ìµëª…';
  const age = document.getElementById('personAge').value || '';
  const note = document.getElementById('healthNote').value.trim();
  if(!note){ alert("ê¸°ë¡í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
  const rec = {name, age, note, time: new Date().toISOString()};
  const arr = JSON.parse(localStorage.getItem(HEALTH_KEY) || '[]');
  arr.unshift(rec);
  localStorage.setItem(HEALTH_KEY, JSON.stringify(arr));
  document.getElementById('healthNote').value = '';
  renderHealthRecords();
  provideFeedback(rec);
}
function renderHealthRecords(){
  const arr = JSON.parse(localStorage.getItem(HEALTH_KEY) || '[]');
  const container = document.getElementById('recordList');
  container.innerHTML = '';
  if(arr.length===0){ container.innerHTML = '<div class="small">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
  arr.slice(0,10).forEach(r=>{
    const d = new Date(r.time);
    const el = document.createElement('div');
    el.style.padding = '8px 0';
    el.innerHTML = `<div style="font-weight:700">${r.name} ${r.age? 'Â· '+r.age+'ì„¸':''} <span class="small" style="font-weight:400"> ${d.toLocaleString()}</span></div>
      <div class="small">${r.note}</div>`;
    container.appendChild(el);
  });
}
function provideFeedback(record){
  const note = record.note.toLowerCase();
  let fb = "ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦ìƒì„ ê´€ì°°í•˜ì„¸ìš”.";
  if(note.includes('ë‘í†µ') || note.includes('ë©”ìŠ¤êº¼') || note.includes('ì–´ì§€')){
    fb = "ë‘í†µì´ë‚˜ ì–´ì§€ëŸ¼ì¦ì´ ìˆìœ¼ë©´ ì¶©ë¶„í•œ íœ´ì‹ê³¼ ìˆ˜ë¶„ ì„­ì·¨ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤. ì¦ìƒ ì§€ì† ì‹œ ì§„ë£Œë¥¼ ë°›ìœ¼ì„¸ìš”.";
  } else if(note.includes('ê¸°ì¹¨') || note.includes('í˜¸í¡') || note.includes('ìˆ¨')){
    fb = "í˜¸í¡ê¸° ì¦ìƒì´ ìˆë„¤ìš”. ê³µê¸°ì§ˆì´ ë‚˜ì  ê²½ìš° ì™¸ì¶œì„ ìì œí•˜ê³  ë§ˆìŠ¤í¬ë¥¼ ì°©ìš©í•˜ì„¸ìš”.";
  } else if(note.includes('í”¼ë¡œ') || note.includes('ì¡¸ë¦¼')){
    fb = "ê³¼ë¡œ/ìˆ˜ë©´ ë¶€ì¡±ì€ ë©´ì—­ ì €í•˜ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íœ´ì‹ì„ ê¶Œì¥í•©ë‹ˆë‹¤.";
  } else if(note.includes('ê´œì°®') || note.includes('ì¢‹')){
    fb = "ì»¨ë””ì…˜ì´ ì–‘í˜¸í•´ ë³´ì…ë‹ˆë‹¤. í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ì„¸ìš”!";
  }
  alert("í”¼ë“œë°±:\n" + fb);
}

/* Export CSV */
function exportHealth(){
  const arr = JSON.parse(localStorage.getItem(HEALTH_KEY) || '[]');
  if(arr.length===0){ alert("ë‚´ë³´ë‚¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
  const rows = arr.map(r => `"${r.name}","${r.age}","${r.time}","${r.note.replace(/"/g,'""')}"`);
  const csv = 'ì´ë¦„,ë‚˜ì´,ì‹œê°„,ë‚´ìš©\n' + rows.join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'health_records.csv'; a.click(); URL.revokeObjectURL(url);
}

/* Render existing records on load */
renderHealthRecords();

/* ---------- Gallery / Certification ---------- */
const GALLERY_KEY = 'heal_gallery_v1';
function uploadCert(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    const dataUrl = ev.target.result;
    const arr = JSON.parse(localStorage.getItem(GALLERY_KEY) || '[]');
    arr.unshift({src:dataUrl, time: new Date().toISOString()});
    localStorage.setItem(GALLERY_KEY, JSON.stringify(arr));
    renderGallery();
    renderGalleryPreview();
    alert("ì‹¤ì²œ ì¸ì¦ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");
  }
  reader.readAsDataURL(file);
}
function renderGallery(){
  const arr = JSON.parse(localStorage.getItem(GALLERY_KEY) || '[]');
  const gallery = document.getElementById('galleryPreview');
  gallery.innerHTML = '';
  arr.slice(0,12).forEach(item=>{
    const img = document.createElement('img');
    img.src = item.src;
    img.title = new Date(item.time).toLocaleString();
    gallery.appendChild(img);
  });
}
function renderGalleryPreview(){ renderGallery(); }
renderGalleryPreview();

/* ---------- Donation handling (local simulated) ---------- */
const DON_KEY = 'heal_donations_v1';
function openDonateModal(){ document.getElementById('donateModal').style.display = 'flex'; }
function closeDonateModal(){ document.getElementById('donateModal').style.display = 'none'; }
function donateAmount(val){ document.getElementById('donInput').value = val; }
function submitDonation(){
  const val = Number(document.getElementById('donInput').value);
  if(!val || val<=0){ document.getElementById('donMsg').innerText = 'ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”'; return; }
  const arr = JSON.parse(localStorage.getItem(DON_KEY) || '[]');
  arr.unshift({amount:val, time:new Date().toISOString()});
  localStorage.setItem(DON_KEY, JSON.stringify(arr));
  document.getElementById('donMsg').innerText = `ê°ì‚¬í•©ë‹ˆë‹¤! â‚©${val} í›„ì›ë˜ì—ˆìŠµë‹ˆë‹¤. (ë°ëª¨)`;
  setTimeout(()=>{ document.getElementById('donMsg').innerText=''; closeDonateModal(); }, 1400);
}
function loadDonations(){
  const arr = JSON.parse(localStorage.getItem(DON_KEY) || '[]');
  const el = document.getElementById('supportList');
  if(arr.length===0){ el.innerText = 'í›„ì› ë‚´ì—­ ì—†ìŒ'; return; }
  el.innerText = 'í›„ì› í•©ê³„: â‚©' + arr.reduce((s,i)=>s+i.amount,0);
}

/* ---------- Missions save ---------- */
function saveMissions(){
  const m1 = document.getElementById('m1').checked;
  const m2 = document.getElementById('m2').checked;
  const m3 = document.getElementById('m3').checked;
  localStorage.setItem('heal_missions_v1', JSON.stringify({m1,m2,m3, time:new Date().toISOString()}));
  alert('ì˜¤ëŠ˜ì˜ ì‹¤ì²œì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

/* ---------- Share summary ---------- */
function shareSummary(){
  const aqi = document.getElementById('dashAQI').innerText;
  const label = document.getElementById('dashLabel').innerText;
  const txt = `ì˜¤ëŠ˜ì˜ AQI: ${aqi} (${label}) - Heal the Health í”„ë¡œì íŠ¸`;
  if(navigator.share){ navigator.share({title:'í™˜ê²½ ê±´ê°• ìš”ì•½', text:txt}).catch(()=>navigator.clipboard.writeText(txt)); }
  else { navigator.clipboard.writeText(txt); alert('ìš”ì•½ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
}

/* ---------- Quiz compute ---------- */
function computeEnvIndex(){
  const s = Number(document.getElementById('q1').value) + Number(document.getElementById('q2').value) + Number(document.getElementById('q3').value);
  const max = 6;
  const percent = Math.round( (s / max) * 100 );
  const el = document.getElementById('quizResult');
  let msg = '';
  if(percent >= 80) msg = `ğŸŒ¿ í›Œë¥­í•©ë‹ˆë‹¤! í™˜ê²½ ì§€ìˆ˜: ${percent} (ì¹œí™˜ê²½ ìƒí™œì„ ì˜ í•˜ê³  ìˆì–´ìš”)`;
  else if(percent >= 50) msg = `ğŸ™‚ ì¢‹ì€ í¸ì´ì—ìš”. í™˜ê²½ ì§€ìˆ˜: ${percent} (ë” ë…¸ë ¥í•˜ë©´ ì¢‹ì•„ìš”)`;
  else msg = `ğŸ”° ì‹œì‘í•´ë´ìš”! í™˜ê²½ ì§€ìˆ˜: ${percent} (ì‘ì€ ì‹¤ì²œìœ¼ë¡œ ê°œì„  ê°€ëŠ¥)`;
  el.innerText = msg;

  // store last score
  localStorage.setItem('heal_last_env_score', JSON.stringify({score:percent, time:new Date().toISOString()}));
  // show quick tip
  setTimeout(()=> alert('Tip: í…€ë¸”ëŸ¬ì™€ ëŒ€ì¤‘êµí†µ ì´ìš©ë¶€í„° ì‹œì‘í•´ ë³´ì„¸ìš”!'), 300);
}

function scrollToQuiz(){ document.getElementById('quizCard').scrollIntoView({behavior:'smooth'}); }

/* ---------- On load: initial states ---------- */
window.addEventListener('load', ()=>{
  // initial gauge & chart state set by simulateRealtime call earlier
  renderHealthRecords();
  renderGalleryPreview();
  loadDonations();
});

/* ---------- small helper: simulated realtime on interval already set above ---------- */
</script>
</body>
</html>
